/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/fly-gesture-unlock@1.0.1/dist/fly-gesture-unlock.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var D=Object.defineProperty,O=(t,e,i)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,a=(t,e,i)=>(O(t,"symbol"!=typeof e?e+"":e,i),i);class R{constructor({id:t,location:e,arrow:i,anchorCircleRadius:s,centerCircleRadius:n},o){a(this,"id"),a(this,"location"),a(this,"arrow"),a(this,"anchorCircleRadius"),a(this,"centerCircleRadius"),a(this,"renderer"),a(this,"status","not-selected"),this.id=t,this.location=e,this.arrow=i,this.anchorCircleRadius=s,this.centerCircleRadius=n,this.renderer=o}render(t){const{anchorCircleBorderWidth:e,anchorCircleBorderColor:i,anchorCircleFillColor:s,anchorCircleShadowColor:n,anchorCircleShadowBlur:o,anchorCircleShadowOffsetX:a,anchorCircleShadowOffsetY:r,centerCircleBorderWidth:h,centerCircleBorderColor:c,centerCircleFillColor:l,centerCircleShadowColor:d,centerCircleShadowBlur:u,centerCircleShadowOffsetX:f,centerCircleShadowOffsetY:g}=this.renderer.anchorStatusStyles[this.status],{x:v,y:S}=this.location,w=(e,i,s,n,o,a,r,h)=>{(i&&s||n)&&(t.shadowColor=o??"transparent",t.shadowBlur=a??0,t.shadowOffsetX=r??0,t.shadowOffsetY=h??0,i&&s&&(t.beginPath(),t.arc(v,S,e-(i??0)/2,0,2*Math.PI,!0),t.lineWidth=i,t.strokeStyle=s,t.stroke()),n&&(t.beginPath(),t.arc(v,S,e-(i??0),0,2*Math.PI,!0),t.fillStyle=n,t.fill()),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0)};w(this.anchorCircleRadius,e,i,s,n,o,a,r),w(this.centerCircleRadius,h,c,l,d,u,f,g)}setStatus(t){this.status=t}}function m(){let t=document.createElement("canvas"),e=t.getContext("2d"),i=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1);return t.width=t.height=0,i}function z(t,e){const i=m(),s=t.width,n=t.height;t.width=s*i,t.height=n*i,t.style.width=s+"px",t.style.height=n+"px",e.scale(i,i)}function k(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function X(t,e,i,s,n){const o=t*t+1,a=2*(t*e-t*s-i),r=a*a-4*o*(i*i+s*s+e*e-n*n-2*e*s);if(r<0)return null;if(0===r){const i=-a/(2*o);return[[i,t*i+e]]}const h=(-a+Math.sqrt(r))/(2*o),c=t*h+e,l=(-a-Math.sqrt(r))/(2*o);return[[h,c],[l,t*l+e]]}function Y(t,e){const i=t.end.x-t.start.x,s=t.end.y-t.start.y,n=(i*(e.center.x-t.start.x)+s*(e.center.y-t.start.y))/(i*i+s*s);if(n<0||n>1)return!1;const o=t.start.x+n*i,a=t.start.y+n*s;return(o-e.center.x)**2+(a-e.center.y)**2<=e.radius**2}const L={getDevicePixelRatio:m,handleHighDprVague:z,distance:k,getIntersectionPoints:X,isLineSegmentIntersectingCircle:Y};class U{constructor({container:t,anchorDefines:e,anchorStatusStyles:i,lineStatusStyles:s,events:n,config:o}){a(this,"container"),a(this,"canvas"),a(this,"ctx"),a(this,"anchorStatusStyles"),a(this,"lineStatusStyles"),a(this,"events"),a(this,"defaultConfig",{arrow:{show:!0,size:5,distance:16},isLineCoverAnchor:!1,isLineAutoSelect:!1,isAnchorRepeatSelect:!1}),a(this,"config",this.defaultConfig),a(this,"anchors"),a(this,"selectedAnchors",[]),a(this,"lineStatus","normal"),a(this,"_freeze",!1),a(this,"_drawing",!1),this.container="string"==typeof t?document.getElementById(t):t,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.anchorStatusStyles=i,this.lineStatusStyles=s,this.events=n,Object.assign(this.config,o??{}),this.handleDOM(this.container,this.canvas,this.ctx),this.bindEvents(),this.anchors=e.map((t=>new R(t,this))),this.render()}render(t){const{isLineCoverAnchor:e}=this.config;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e||(this.drawAnchorLine(),t&&this._drawing&&this.drawLastAnchorMouseLine(t)),this.anchors.forEach((t=>t.render(this.ctx))),e&&(this.drawAnchorLine(),t&&this._drawing&&this.drawLastAnchorMouseLine(t)),this.drawAnchorArrow()}bindEvents(){this.canvas.addEventListener("touchstart",(t=>this.handleEvent(t,"start"))),this.canvas.addEventListener("mousedown",(t=>this.handleEvent(t,"start"))),this.canvas.addEventListener("touchmove",(t=>this.handleEvent(t,"move"))),this.canvas.addEventListener("mousemove",(t=>this.handleEvent(t,"move"))),this.canvas.addEventListener("touchend",(t=>this.handleEvent(t,"end"))),this.canvas.addEventListener("mouseup",(t=>this.handleEvent(t,"end"))),this.canvas.addEventListener("mouseleave",(t=>this.handleEvent(t,"leave")))}drawAnchorLine(){const{lineWidth:t,lineColor:e}=this.lineStatusStyles[this.lineStatus];this.ctx.lineWidth=t,this.ctx.strokeStyle=e,this.selectedAnchors.forEach(((t,e,i)=>{const s=i[e+1];if(!s)return;const{location:n}=t,{location:o}=s;this.drawTwoLocationLine(n,o)}))}drawAnchorArrow(){const{lineWidth:t,lineColor:e}=this.lineStatusStyles[this.lineStatus];this.ctx.lineWidth=t,this.ctx.strokeStyle=e,this.selectedAnchors.forEach(((t,e,i)=>{const s=i[e+1];s&&this.config.arrow.show&&this.drawArrow(t,s)}))}drawLastAnchorMouseLine(t){const e=this.selectedAnchors[this.selectedAnchors.length-1];if(!e)return;const i=this.gainMouseTouchLocation(t);this.drawTwoLocationLine(e.location,i)}drawTwoLocationLine(t,e){this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}drawArrow(t,e){const{location:i,arrow:s}=t,{location:n}=e,{ctx:o}=this,a=(null==s?void 0:s.distance)??this.config.arrow.distance,r=(null==s?void 0:s.size)??this.config.arrow.size,h=L.distance(i,n),c=i.x+a*((n.x-i.x)/h),l=i.y+a*((n.y-i.y)/h),d=i.x+(a+r)*((n.x-i.x)/h),u=i.y+(a+r)*((n.y-i.y)/h);let f,g,v,S;if(i.x===n.x)f=c-r,g=l,v=c+r,S=l;else if(i.y===n.y)f=c,g=l-r,v=c,S=l+r;else{const t=-1/((n.y-i.y)/(n.x-i.x)),e=l-t*c,s=L.getIntersectionPoints(t,e,c,l,r);2===(null==s?void 0:s.length)?(f=s[0][0],g=s[0][1],v=s[1][0],S=s[1][1]):f=g=v=S=0}o.beginPath(),o.moveTo(d,u),o.lineTo(f,g),o.lineTo(v,S),o.closePath(),o.fillStyle=this.lineStatusStyles[this.lineStatus].lineColor,o.fill()}setStatus(t){if(t){if(["not-selected","selected"].includes(t))return void console.log("setStatus 方法只允许设置额外状态，不允许设置 not-selected 以及 selected，不会进行任何操作！");if(!this.anchorStatusStyles[t])return void console.error(`没有定义 ${t} 状态的 anchorStatusStyles，不会进行任何操作！`);if(!this.lineStatusStyles[t])return void console.error(`没有定义 ${t} 状态的 lineStatusStyles，不会进行任何操作！`);if(!this.selectedAnchors.length)return void console.error("没有选中的锚点，不进行任何操作！");this.lineStatus=t,this.selectedAnchors.forEach((e=>e.setStatus(t))),this.render()}}handleDOM(t,e,i){t||console.error("Unable to obtain container element"),i||console.error("Unable to obtain CanvasRenderingContext2D"),t&&i&&(e.width=t.clientWidth,e.height=t.clientHeight,e.style.cursor="pointer",t.appendChild(e),L.handleHighDprVague(e,i))}handleEvent(t,e){t.preventDefault(),!this._freeze&&("start"===e&&this.handleStart(t),"move"===e&&this.handleMove(t),"end"===e&&this.handleEnd(),"leave"===e&&this.handleLeave())}handleStart(t){const e=this.gainMouseTouchLocation(t);this.containLocationAnchor(e)&&(this._drawing=!0,this.reset()),this.pickAnchorUpdateData(e,"start"),this.render(t)}handleMove(t){if(!this._drawing)return;const e=this.gainMouseTouchLocation(t);this.pickAnchorUpdateData(e,"move"),this.render(t)}handleEnd(){var t,e;this._drawing&&(null==(e=null==(t=this.events)?void 0:t.end)||e.call(t,this.selectedAnchors)),this._drawing=!1,this.render()}handleLeave(){this.handleEnd()}reset(){this.selectedAnchors=[],this.lineStatus="normal",this.anchors.forEach((t=>t.setStatus("not-selected"))),this.render()}pickAnchorUpdateData(t,e){var i,s,n;const o=this.containLocationAnchor(t);if(o&&(this.config.isAnchorRepeatSelect?(null==(i=this.lastSelectedAnchor)?void 0:i.id)!==o.id:!this.selectedAnchors.includes(o))){if(this.config.isLineAutoSelect&&this.lastSelectedAnchor){const t=this.anchors.filter((t=>!([this.lastSelectedAnchor.id,o.id].includes(t.id)||!this.config.isAnchorRepeatSelect&&this.selectedAnchors.includes(t))&&L.isLineSegmentIntersectingCircle({start:this.lastSelectedAnchor.location,end:o.location},{center:t.location,radius:t.anchorCircleRadius}))).sort(((t,e)=>{const{location:i}=this.lastSelectedAnchor;return L.distance(i,t.location)-L.distance(i,e.location)}));null!=t&&t.length&&(t.forEach((t=>t.setStatus("selected"))),this.selectedAnchors.push(...t))}o.setStatus("selected"),this.selectedAnchors.push(o),null==(n=null==(s=this.events)?void 0:s["start"===e?"start":"update"])||n.call(s,this.selectedAnchors)}}gainMouseTouchLocation(t){let e,i;const{top:s,left:n}=this.canvas.getBoundingClientRect();return"clientX"in t?(e=t.clientX-n,i=t.clientY-s):(e=t.changedTouches[0].pageX-n,i=t.changedTouches[0].pageY-s),{x:e,y:i}}containLocationAnchor(t){return this.anchors.find((e=>L.distance(t,e.location)<e.anchorCircleRadius))}freeze(){this._freeze=!0}unFreeze(){this._freeze=!1}resize(t,e={}){var i,s;Object.assign(this.config,e),this.canvas.width=(null==(i=this.container)?void 0:i.clientWidth)??0,this.canvas.height=(null==(s=this.container)?void 0:s.clientHeight)??0,L.handleHighDprVague(this.canvas,this.ctx);const n=this.anchors;this.anchors=t.map((t=>new R(t,this))),this.anchors.forEach((t=>{const e=n.find((e=>e.id===t.id));e&&(t.status=e.status)})),this.selectedAnchors=this.selectedAnchors.map((t=>this.anchors.find((e=>e.id===t.id)))).filter((t=>!!t)),this.render()}get lastSelectedAnchor(){return this.selectedAnchors[this.selectedAnchors.length-1]}static AnchorMatrixFactory({canvasSize:t,padding:e,matrix:i,anchor:s,customId:n}){const o=[],{width:a,height:r}=t;let h,c,l,d;"number"==typeof e?h=c=l=d=e:(h=e.top,c=e.right,l=e.bottom,d=e.left);const{row:u,column:f}=i,{anchorCircleRadius:g,centerCircleRadius:v}=s,S=(r-h-l-2*g*u)/(u-1),w=(a-d-c-2*g*f)/(f-1);let x=1;for(let t=1;t<=u;t++)for(let e=1;e<=f;e++)o.push({id:n?n(t,e):(x++).toString(),location:{x:d+g+(e-1)*(2*g+w),y:h+g+(t-1)*(2*g+S)},anchorCircleRadius:g,centerCircleRadius:v});return o}}export{R as Anchor,U as default};
//# sourceMappingURL=/sm/ea10c5639629b1939c6ee1cdd76ac78a3a94dd0d17741da4880d73bc5b82a2e1.map